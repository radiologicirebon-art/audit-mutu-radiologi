<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Audit Mutu Foto Thoraks</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{font-family:Arial,sans-serif;background:#f4f6f9;margin:0}
header{background:#0d6efd;color:white;padding:15px;text-align:center}
nav{display:flex;background:#fff;border-bottom:1px solid #ddd}
nav button{flex:1;padding:12px;border:none;background:#fff;cursor:pointer;font-weight:bold}
nav button.active{background:#0d6efd;color:white}
section{padding:15px}
.card{background:white;padding:15px;border-radius:6px;margin-bottom:15px}
table{width:100%;border-collapse:collapse}
table th,table td{border:1px solid #ddd;padding:8px;text-align:center}
table th{background:#f0f0f0}
input,textarea,select{width:100%;padding:6px;margin-top:4px}
button.submit{background:#198754;color:white;border:none;padding:12px;width:100%;font-size:16px;border-radius:6px;cursor:pointer}
.stat{display:flex;gap:10px}
.stat div{flex:1;background:white;padding:15px;border-radius:6px;text-align:center}
.printBtn{background:#0d6efd;color:white;border:none;padding:10px 15px;border-radius:6px;cursor:pointer;margin-bottom:10px}
.smallBtn{background:#198754;color:white;border:none;padding:6px 10px;border-radius:4px;cursor:pointer}
</style>
</head>

<body>

<header>
<h2>AUDIT MUTU FOTO THORAKS</h2>
</header>

<nav>
<button class="active" onclick="showTab('input',this)">üìù Input Audit</button>
<button onclick="showTab('dashboard',this)">üìä Dashboard Mutu</button>
</nav>

<section id="input">
<form id="auditForm">

<div class="card">
<h3>A. Identitas Pemeriksaan</h3>

<label>Pasien</label>
<input type="text" id="pasien" required>

<label>Tanggal Lahir</label>
<input type="date" id="tgl_lahir" required>

<label>Radiografer</label>
<select id="radiografer" required>
<option value="">-- pilih --</option>
<option>Ino Hadiwinata, A.Md.Rad</option>
<option>Lalan Permana Herlambang, A.Md.Rad</option>
<option>Feby Fardianto, A.Md.Rad</option>
<option>Elis Mandalasari, A.Md.Rad</option>
<option>Argo Nur Pujianto</option>
<option>Tikha Kania, A.Md.Rad</option>
<option>Ipu Yoga Pradetza, A.Md.Rad</option>
<option>Sri Cahyati, A.Md.Rad</option>
<option>Opan Sopandi, A.Md.Rad</option>
<option>Mohamad Vinggih Hernanda, A.Md.Rad</option>
<option>Fahmi Puja Ashri, A.Md.Rad</option>
<option>Gilang Nurgianti Fadilah, A.Md.Rad</option>
<option>Ardi Pratama Oktafiansyah, A.Md.Rad</option>
<option>Zhafira Nur Hasanah, A.Md.Rad</option>
<option>Dwi Alfi Pramesti, A.Md.Rad</option>
<option>Rita Riana, A.Md.Rad</option>
<option>Muhammad Rizky Maulana, A. Md. Kes.</option>
<option>Muhammad Rafi Azhar, A. Md. Kes</option>
<option>Dias Riyandi, A.Md. Kes</option>
<option>Mochamad Taufik H, A.Md. Kes</option>
<option>Arief Maulana, A.Md. Kes</option>
<option>Salsa Dea Charira, A.Md. Kes</option>
</select>
</div>

<div class="card">
<h3>B. Penilaian Teknis</h3>

<script>
function grid(name,items){
  document.write('<table>');
  document.write('<tr><th>Kriteria</th><th>Ya</th><th>Tidak</th></tr>');
  items.forEach(i=>{
    document.write(`
    <tr>
      <td>${i}</td>
      <td><input type="radio" name="${name+i}" value="Ya" required></td>
      <td><input type="radio" name="${name+i}" value="Tidak" required></td>
    </tr>`);
  });
  document.write('</table><br>');
}
</script>

<strong>1. Posisi & Rotasi</strong>
<script>
grid("posisi",[
"Proyeksi sesuai indikasi",
"Tidak ada rotasi",
"Klavikula simetris",
"Skapula keluar lapang paru"
]);
</script>

<strong>2. Inspirasi</strong>
<script>
grid("insp",[
"Inspirasi adekuat",
"‚â•10 iga posterior terlihat",
"Paru mengembang optimal"
]);
</script>

<strong>3. Exposure</strong>
<script>
grid("expo",[
"Vertebra torakal tampak samar",
"Marking vaskular jelas",
"Tidak under-exposed",
"Tidak over-exposed",
"Detail tulang terlihat"
]);
</script>

<strong>4. Cakupan Anatomi</strong>
<script>
grid("anatomi",[
"Apeks paru masuk",
"Costophrenicus terlihat",
"Dinding toraks lateral masuk"
]);
</script>

<strong>5. Ketajaman & Artefak</strong>
<script>
grid("artefak",[
"Tidak ada motion",
"Batas jantung jelas",
"Tidak ada artefak",
"Marker R/L benar"
]);
</script>
</div>

<div class="card">
<h3>C. Kesimpulan</h3>
<select id="kesimpulan" required>
<option value="">-- pilih --</option>
<option>Mutu baik</option>
<option>Mutu cukup</option>
<option>Mutu kurang</option>
</select>
</div>

<button class="submit">üíæ Simpan Audit</button>
</form>
</section>

<section id="dashboard" style="display:none">
<div class="stat">
<div><h3 id="total">0</h3>Total Audit</div>
<div><h3 id="baik">0</h3>Mutu Baik</div>
<div><h3 id="cukup">0</h3>Mutu Cukup</div>
<div><h3 id="kurang">0</h3>Mutu Kurang</div>
</div>
<button class="printBtn" onclick="printDashboard()">üñ® Print Semua Data</button>
<div class="card">
<h3>Data Audit</h3>
<table id="table"></table>
</div>
</section>

<script>
function showTab(tab,btn){
  document.getElementById("input").style.display = tab==="input"?"block":"none";
  document.getElementById("dashboard").style.display = tab==="dashboard"?"block":"none";
  document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
}

firebase.initializeApp({
  databaseURL:"https://auditmutu-radiologi-default-rtdb.asia-southeast1.firebasedatabase.app/"
});
const db = firebase.database();

auditForm.addEventListener("submit",e=>{
  e.preventDefault();

  const penilaian={};
  document.querySelectorAll('input[type=radio]:checked').forEach(r=>penilaian[r.name]=r.value);

  db.ref("audit").push({
    pasien:pasien.value,
    tgl_lahir:tgl_lahir.value,
    radiografer:radiografer.value,
    kesimpulan:kesimpulan.value,
    penilaian:penilaian,
    created:Date.now()
  }).then(()=>{
    alert("Audit tersimpan");
    auditForm.reset();
  });
});

db.ref("audit").on("value",snap=>{
  let t=0,b=0,c=0,k=0;

  table.innerHTML=`<tr>
  <th>Pasien</th>
  <th>Tgl Lahir</th>
  <th>Radiografer</th>
  <th>Kesimpulan</th>
  </tr>`;

  snap.forEach(s=>{
    let d=s.val();
    t++;
    if(d.kesimpulan==="Mutu baik") b++;
    if(d.kesimpulan==="Mutu cukup") c++;
    if(d.kesimpulan==="Mutu kurang") k++;

    table.innerHTML+=`<tr>
      <td>${d.pasien}</td>
      <td>${d.tgl_lahir}</td>
      <td>${d.radiografer}</td>
      <td>${d.kesimpulan}</td>
    </tr>`;
  });

  total.textContent=t;
  baik.textContent=b;
  cukup.textContent=c;
  kurang.textContent=k;
});
</script>
</body>
</html>
